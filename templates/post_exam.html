{% extends 'base.html' %}

{% block content %}
<div class="card shadow-sm p-4 mx-auto" style="max-width: 600px;">
    <h2 class="text-center mb-4">Post Exam Assessment</h2>

    <form method="POST">
        <!-- Examiner Selection -->
        <div class="mb-3">
            <label for="examiner-select" class="form-label">Examiner Name</label>
            <select class="form-select" id="examiner-select" name="name" required>
                <option value="">-- Select Examiner --</option>
                {% for e in examiners %}
                    <option value="{{ e['Name'] }}" data-id="{{ e['Id'] }}" data-status="{{ e['Status'] }}">
                        {{ e['Name'] }}
                    </option>
                {% endfor %}
            </select>
            <input type="hidden" name="examinerid" id="examiner-id">
        </div>

        <!-- Exam Selection -->
        <div class="mb-3">
            <label for="exam-select" class="form-label">Exam</label>
            <select class="form-select" id="exam-select" name="exam" required>
                <option value="">-- Select Exam --</option>
                {% for ex in exams %}
                    <option value="{{ ex['Name'] }}">{{ ex['Name'] }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Comments -->
        <div class="mb-3">
            <label for="comment" class="form-label">Comments</label>
            <textarea class="form-control" name="comment" id="comment" rows="3" placeholder="Enter comments here"></textarea>
        </div>

        <!-- Current Status -->
        <div class="mb-3">
            <label for="current-status" class="form-label">Current Status</label>
            <input type="text" class="form-control" id="current-status" readonly disabled>
        </div>

        <!-- Show Status Update Button -->
        <div class="mb-3">
            <button type="button" class="btn btn-secondary w-100" id="show-status-update">Update Status</button>
        </div>

        <!-- Status Update Section -->
        <div class="mb-3" id="status-update-section" style="display: none;">
            <label for="status-select" class="form-label">New Status</label>
            <select class="form-select" name="status" id="status-select">
                <option value="">-- Select New Status --</option>
                {% for s in statuses %}
                    <option value="{{ s['Type'] }}">{{ s['Type'] }}</option>
                {% endfor %}
            </select>
        </div>

        <!-- Submit -->
        <div class="d-grid">
            <button type="submit" class="btn btn-primary btn-lg">Submit</button>
        </div>
    </form>
</div>

<script>
    const examinerSelect = document.getElementById('examiner-select');
    const examinerIdInput = document.getElementById('examiner-id');
    const currentStatusField = document.getElementById('current-status');

    examinerSelect.addEventListener('change', function(){
        const selectedOption = this.options[this.selectedIndex];
        examinerIdInput.value = selectedOption.dataset.id;
        currentStatusField.value = selectedOption.dataset.status || "";
    });

    document.getElementById('show-status-update').addEventListener('click', function(){
        document.getElementById('status-update-section').style.display = 'block';
    });
</script>
{% endblock %}